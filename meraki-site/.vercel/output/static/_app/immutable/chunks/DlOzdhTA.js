import{s as E,a as c,e as m,c as y,u as $,g as b,b as z,d as v}from"./CB5cRc80.js";import{S,i as D,d as I,t as p,a as w,m as M,c as q,b as C}from"./DdXpAeTr.js";import{I as N,g as A,a as O}from"./Dz6vXNSI.js";import{w as l}from"./Da5tC44D.js";import{s as i}from"./CxqqRnSu.js";import{d as h}from"./DsIx7zWP.js";function j(t){let e;const r=t[2].default,a=y(r,t,t[3],null);return{c(){a&&a.c()},l(o){a&&a.l(o)},m(o,n){a&&a.m(o,n),e=!0},p(o,n){a&&a.p&&(!e||n&8)&&$(a,r,o,o[3],e?z(r,o[3],n,null):b(o[3]),null)},i(o){e||(w(a,o),e=!0)},o(o){p(a,o),e=!1},d(o){a&&a.d(o)}}}function L(t){let e,r;const a=[{name:"calendar"},t[1],{iconNode:t[0]}];let o={$$slots:{default:[j]},$$scope:{ctx:t}};for(let n=0;n<a.length;n+=1)o=c(o,a[n]);return e=new N({props:o}),{c(){C(e.$$.fragment)},l(n){q(e.$$.fragment,n)},m(n,s){M(e,n,s),r=!0},p(n,[s]){const d=s&3?A(a,[a[0],s&2&&O(n[1]),s&1&&{iconNode:n[0]}]):{};s&8&&(d.$$scope={dirty:s,ctx:n}),e.$set(d)},i(n){r||(w(e.$$.fragment,n),r=!0)},o(n){p(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function P(t,e,r){let{$$slots:a={},$$scope:o}=e;const n=[["path",{d:"M8 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}],["path",{d:"M3 10h18"}]];return t.$$set=s=>{r(1,e=c(c({},e),m(s))),"$$scope"in s&&r(3,o=s.$$scope)},e=m(e),[n,e,a,o]}class K extends S{constructor(e){super(),D(this,e,P,L,E,{})}}const u=l([]),_=l(!0),g=l(null);async function f(){_.set(!0),g.set(null);try{const{data:t,error:e}=await i.from("eventi").select("*").order("data_inizio",{ascending:!1});if(e)throw e;u.set(t||[])}catch(t){console.error("Error loading eventi:",t),g.set(t.message)}finally{_.set(!1)}}async function Q(){try{const t=new Date().toISOString(),{data:e,error:r}=await i.from("eventi").select("*").lte("data_inizio",t).gte("data_fine",t).order("data_inizio",{ascending:!1});if(r)throw r;return e||[]}catch(t){return console.error("Error loading eventi attivi:",t),[]}}async function R(t){try{const{data:e,error:r}=await i.from("eventi").insert([t]).select().single();if(r)throw r;return await f(),{success:!0,data:e}}catch(e){return console.error("Error adding evento:",e),{success:!1,error:e.message}}}async function T(t,e){try{if(e.hasOwnProperty("immagine_url")){const n=v(u).find(s=>s.id===t);n&&n.immagine_url&&n.immagine_url!==e.immagine_url&&await h(n.immagine_url)}const{data:r,error:a}=await i.from("eventi").update(e).eq("id",t).select().single();if(a)throw a;return await f(),{success:!0,data:r}}catch(r){return console.error("Error updating evento:",r),{success:!1,error:r.message}}}async function U(t){try{const r=v(u).find(o=>o.id===t);r&&r.immagine_url&&await h(r.immagine_url);const{error:a}=await i.from("eventi").delete().eq("id",t);if(a)throw a;return await f(),{success:!0}}catch(e){return console.error("Error deleting evento:",e),{success:!1,error:e.message}}}function V(t){const e=new Date,r=new Date(t.data_inizio),a=new Date(t.data_fine);return e>=r&&e<=a}export{K as C,Q as a,R as b,U as d,u as e,V as i,f as l,T as u};
