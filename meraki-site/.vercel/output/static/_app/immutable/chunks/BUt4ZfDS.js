import{w as u}from"./Da5tC44D.js";import{s as c}from"./CxqqRnSu.js";import{d as h}from"./DsIx7zWP.js";import{d as p}from"./CB5cRc80.js";const g=u([]),d=u(!0),f=u(null);async function S(){d.set(!0),f.set(null);try{const{data:r,error:e}=await c.from("categories").select("*").order("id",{ascending:!0});if(e)throw e;g.set(r||[])}catch(r){console.error("Error loading categories:",r),f.set(r.message)}finally{d.set(!1)}}async function C(r){try{const{data:e,error:t}=await c.from("categories").insert([{name:r,subcategories:[]}]).select().single();if(t)throw t;return g.update(s=>[...s,e]),{success:!0,data:e}}catch(e){return console.error("Error adding category:",e),{success:!1,error:e.message}}}async function M(r,e){try{const{data:t,error:s}=await c.from("categories").update(e).eq("id",r).select().single();if(s)throw s;return g.update(a=>a.map(o=>o.id===r?t:o)),{success:!0,data:t}}catch(t){return console.error("Error updating category:",t),{success:!1,error:t.message}}}async function v(r){try{const{error:e}=await c.from("categories").delete().eq("id",r);if(e)throw e;return g.update(t=>t.filter(s=>s.id!==r)),{success:!0}}catch(e){return console.error("Error deleting category:",e),{success:!1,error:e.message}}}async function L(r,e){try{const{data:t,error:s}=await c.from("categories").select("subcategories").eq("id",r).single();if(s)throw s;const a=[...t.subcategories||[],e],{data:o,error:n}=await c.from("categories").update({subcategories:a}).eq("id",r).select().single();if(n)throw n;return g.update(l=>l.map(m=>m.id===r?o:m)),{success:!0,data:o}}catch(t){return console.error("Error adding subcategory:",t),{success:!1,error:t.message}}}async function x(r,e){try{const{data:t,error:s}=await c.from("categories").select("subcategories").eq("id",r).single();if(s)throw s;const a=(t.subcategories||[]).filter(l=>l!==e),{data:o,error:n}=await c.from("categories").update({subcategories:a}).eq("id",r).select().single();if(n)throw n;return g.update(l=>l.map(m=>m.id===r?o:m)),{success:!0,data:o}}catch(t){return console.error("Error removing subcategory:",t),{success:!1,error:t.message}}}function F(r,e){const t=r.find(s=>s.name===e);return t?t.subcategories:[]}const i=u([]),y=u(!0),w=u(null);async function O(){y.set(!0),w.set(null);try{const{data:r,error:e}=await c.from("menu_items").select("*").order("sort_order",{ascending:!0});if(e)throw e;i.set(r||[])}catch(r){console.error("Error loading menu:",r),w.set(r.message)}finally{y.set(!1)}}async function P(r){try{const{data:e,error:t}=await c.from("menu_items").insert([r]).select().single();if(t)throw t;return i.update(s=>[...s,e]),{success:!0,data:e}}catch(e){return console.error("Error adding menu item:",e),{success:!1,error:e.message}}}async function j(r,e){try{if(e.hasOwnProperty("image_url")){const o=p(i).find(n=>n.id===r);o&&o.image_url&&o.image_url!==e.image_url&&await h(o.image_url)}const{data:t,error:s}=await c.from("menu_items").update(e).eq("id",r).select().single();if(s)throw s;return i.update(a=>a.map(o=>o.id===r?t:o)),{success:!0,data:t}}catch(t){return console.error("Error updating menu item:",t),{success:!1,error:t.message}}}async function k(r){try{const t=p(i).find(a=>a.id===r);t&&t.image_url&&await h(t.image_url);const{error:s}=await c.from("menu_items").delete().eq("id",r);if(s)throw s;return i.update(a=>a.filter(o=>o.id!==r)),{success:!0}}catch(e){return console.error("Error deleting menu item:",e),{success:!1,error:e.message}}}export{O as a,C as b,g as c,v as d,L as e,j as f,F as g,P as h,k as i,S as l,i as m,x as r,M as u};
